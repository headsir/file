# 							网络爬虫从入门到实践

## 第1章 网络爬虫入门

### 	1.1 网络爬虫是否合法

#### 		1.1.1 Robots 协议

​				Robots 协议（爬虫协议）：网络爬虫排除标准（Robots Exclusion Protocol)

​				网络遵守协议，国际互联网界通行的<font color = red size = 5>道德规范</font>

​				淘宝网的robots.txt查看：https://www.taobao.com/robots.txt

协议内容：

> Disallow 禁止访问
>
> Allow 允许访问

#### 		1.1.2 网络爬虫的约束

​				爬虫自我约束：过快或者频密的访问网站，会给服务器带来巨大压力，网站会封IP或者法律行动

​				<font color = gree size = 5>遵守Robot 协议、约束爬虫速度、访问频率，使用数据保护网站知识产权</font>

### 	1.2 网络爬虫

#### 		1.2.1 Python 爬虫的流程

​				三部分： 获取网页 、解析网页（提取数据）、 储存数据

```mermaid
graph LR
	id1[获取网页]-->id2["<font color=red size=5>解析网页<br />（提取数据）</font>"]-->id3[储存数据]			
```

#### 		1.2.2 三个流程的技术实现

- 获取网页

  > 基础技术
  >
  > > > requests、urllib、selenium
  > >
  > > 进阶技术
  > >
  > > > 多进程多线程抓取、登录抓取、突破IP封禁、使用服务器抓取

 - 解析网页

   > 基础技术
   >
   > > re 正则表达式、BeautifulSoup、lxml
   >
   > 进阶技术
   >
   > > 解决中文乱码

- 储存数据

  > 基础技术
  >
  > > 存入txt文件、存入csv文件
  >
  > 进阶技术
  >
  > > 存入MySQLl数据库、MongoDB数据库

## 第2章 编写第一个网络爬虫

### 2.1 编写第一个简单的爬虫

#### 2.1.1 第一步：获取网页

1. 导入模块 requests

2. 定义目标网址地址url：http://www.santostang.com

3. 定义浏览器代理请求头headers

4. 获取网站返回内容Response

   ```python
   # coding:utf-8
   import requests  # 导入模块requests
   
   # 定义url为目标网址
   url = "http://www.santostang.com"
   # 定义请求头的浏览器代理，伪装成浏览器
   headers = {
       "User-Agent":
           "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0"
   }
   
   # 请求网页
   response = requests.get(url, headers=headers)
   print(response)  # 返回响应代码
   print(response.text)  # 返回网页内容代码
   ```

#### 2.1.2 第二步：提取需要的数据

1. 解析网页
2. 提取元素

```python
from bs4 import BeautifulSoup

# 解析页面
soup = BeautifulSoup(response.text, "html.parser")

# 找到第一篇文章标题，定位到class 是“post-title”的h1元素，提取a 里面的字符串，strip() 去除左右空格
title = soup.find("h1", class_="post-title").a.text.strip()
print(title)
```

#### 2.1.3  第三步：储存数据

储存到`title_test.txt`

```python
# 打开一个空白的txt,然后使用f.write写入刚刚的字符串title
with open('title_test.txt', "a+") as f:
    f.write(title)
```

### 2.2 Python 实践：基础巩固

#### 2.2.1 Python 基础试题

##### 试题1：输出奇数

请使用Python 中的循环打印输出从1到100的所有奇数

```python
for i in range(101):
    # if i % 2 == 1:
    #     print(i)
    while i < 101 and i % 2 == 1:
        print(i)
        i += 1
```

##### 试题2：修改字符串

请将字符串"你好$$$我正在学 Python@#@#现在需要&*&*&修改字符串"中的符号变成一个空格，需要输出的格式为："你好 我正在学 Python 现在需要 修改字符串"

```python
str1 = "你好$$$我正在学 Python@#@#现在需要&*&*&修改字符串"

str2 = str1.replace("$$$", " ").replace("&*&*&", " ").replace("@#@#", " ")  # replace 替换函数
print(str2)

import re  # 导入正则表达式模块

# re.sub("表达式","替换内容","需要处理的字符串")
str2 = re.sub('[@$&*#]+', " ", str1)
print(str2)
```

##### 试题3：输出乘法口诀表

输出 9 x 9 乘法口诀表

```python
for i in range(1, 10):
    for j in range(1, i + 1):
        print("%d x %d = %d\t" % (j, i, i * j), end="") # \t 水平制表符，end="" 禁止打印换行
    print("")
```

##### 试题4：写函数算奖金

请写出一个函数，当输入函数变量月利润为Ⅰ时，能返回应发放奖金的总数。例如，输出“利润为100 000元时，应发放奖金总数为10 000元”。其中，企业发放的奖金根据利润提成。利润（Ⅰ）低于或等于 10 万元时，奖金可提 10%；利润高于 10万元，低于 20 万元时，低于 10 万元的部分按 10%提成，高于 10 万元的部分，可提成 7.5%；利润在 20 万元到 40 万元之间时，高于 20 万元的部分可提成 5%；利润在 40 万元到 60 万元之间时，高于 40 万元的部分可提成 3%；利润在 60 万元到 100 万元之间时，高于 60 万元的部分可提成 1.5%；利润高于 100 万元时，超过 100 万元时，超过 100 万元的部分按 1%提成。

第一种方案：

```python
import pysnooper #代码调试模块


@pysnooper.snoop("log.txt")
def profits_bonus(I):
    I = I / 10000
    if I <= 10:
        b = I * 0.1
        return b * 10000
    elif I > 10 and I <= 20:
        b = 10 * 0.1 + (I - 10) * 0.075
        return b * 10000
    elif I > 20 and I <= 40:
        b = 10 * 0.1 + 10 * 0.075 + (I - 20) * 0.05
        return b * 10000
    elif I > 40 and I <= 60:
        b = 10 * 0.1 + 10 * 0.075 + 20 * 0.05 + (I - 40) * 0.03
        return b * 10000
    elif I > 60 and I <= 100:
        b = 10 * 0.1 + 10 * 0.075 + 20 * 0.05 + 20 * 0.03 + (I - 60) * 0.015
        return b * 10000
    else:
        b = 10 * 0.1 + 10 * 0.075 + 20 * 0.05 + 40 * 0.03 + (I - 100) * 0.01
        return b * 10000


I = int(input("请输入月度利润："))
bonus = profits_bonus(I)
print("月度利润为%d元时，应发奖金总数为%d元" % (I, bonus))
```

第二种方案：

```python
import pysnooper


@pysnooper.snoop("log.txt")
def profits_bonus(I):
    # 月度利润的分界值
    arr = [1000000, 600000, 400000, 200000, 100000, 0]
    # 分界值对应的奖金比例值
    rat = [0.01, 0.015, 0.03, 0.05, 0.075, 0.1]
    # 总奖金初始值
    b = 0
    for idx in range(6):
        if I > arr[idx]:
            b = b + (I-arr[idx]) * rat[idx]
            I = arr[idx]
    return b

I = int(input("请输入月度利润："))
bonus = profits_bonus(I)
print("月度利润为%d元时，应发奖金总数为%d元" % (I, bonus))
```

##### 试题5：对字典进行排序

用字典的值对字典进行排序，将``{1:2,3:4,4:3,2:1,0:0}``按照字典的值从大到小进行排序

```
import operator  # operator 模块提供了一套与 Python 的内置运算符对应的高效率函数。

dic = {1: 2, 3: 4, 4: 3, 2: 1, 0: 0}

# sorted() 函数对所有可迭代的对象进行排序操作
# perator.itemgetter函数获取的不是值，而是定义了一个函数，通过该函数作用到对象上才能获取值
sorted_dic = sorted(dic.items(), key=operator.itemgetter(0))

print(sorted_dic)
```

#### 2.2.2 自我实践

